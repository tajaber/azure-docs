---
author: elazark
ms.service: defender-for-cloud
ms.topic: include
ms.date: 11/09/2022
ms.author: elkrieger
ms.custom: generated
---

There are **25** GCP recommendations in this category.

|Recommendation |Description |Severity |
|---|---|---|
|[Cryptographic keys should not have more than three users](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/24eb0365-d63d-43c0-b11f-8b0a1a0842f7) |This recommendation evaluates IAM policies for key rings, projects, and organizations, and retrieves principals with roles that allow them to encrypt, decrypt or sign data using Cloud KMS keys: roles/owner, roles/cloudkms.cryptoKeyEncrypterDecrypter, roles/cloudkms.cryptoKeyEncrypter, roles/cloudkms.cryptoKeyDecrypter, roles/cloudkms.signer, and roles/cloudkms.signerVerifier. |Medium |
|[Ensure API keys are not created for a project](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/29ed3416-2035-4d44-986e-0bcbb7de172e) |Keys are insecure because they can be viewed publicly, such as from within a browser, or they can be accessed on a device where the key resides. It is recommended to use standard authentication flow instead. <br><br> Security risks involved in using API-Keys appear below:<br> 1. API keys are simple encrypted strings<br> 2. API keys do not identify the user or the application making the API request<br> 3. API keys are typically accessible to clients, making it easy to discover and steal an API key <br><br> To avoid the security risk in using API keys, it is recommended to use standard authentication flow instead. |High |
|[Ensure API keys are restricted to only APIs that application needs access](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/54d3b0ae-67b3-4fee-9ac4-f6c784b9d16b) |API keys are insecure because they can be viewed publicly, such as from within a browser, or they can be accessed on a device where the key resides. It is recommended to restrict API keys to use (call) only APIs required by an application. <br><br> Security risks involved in using API-Keys are below:<br> 1. API keys are simple encrypted strings<br> 2. API keys do not identify the user or the application making the API request<br> 3. API keys are typically accessible to clients, making it easy to discover and steal an API key <br><br>In light of these potential risks, Google recommends using the standard authentication flow instead of API-Keys. However, there are limited cases where API keys are more appropriate. For example, if there is a mobile application that needs to use the Google Cloud Translation API, but doesn't otherwise need a backend server, API keys are the simplest way to authenticate to that API.<br><br> In order to reduce attack surfaces by providing least privileges, API-Keys can be restricted to use (call) only APIs required by an application. |High |
|[Ensure API keys are restricted to use by only specified Hosts and Apps](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/63e0e2db-70c3-4edc-becf-93961d3156ed) |Unrestricted keys are insecure because they can be viewed publicly, such as from within a browser, or they can be accessed on a device where the key resides. It is recommended to restrict API key usage to trusted hosts, HTTP referrers and apps. <br><br> Security risks involved in using API-Keys appear below:<br> 1. API keys are simple encrypted strings<br> 2. API keys do not identify the user or the application making the API request<br> 3. API keys are typically accessible to clients, making it easy to discover and steal an API key <br><br>In light of these potential risks, Google recommends using the standard authentication flow instead of API keys. However, there are limited cases where API keys are more appropriat. <br>For example, if there is a mobile application that needs to use the Google Cloud Translation API, but doesn't otherwise need a backend server, API keys are the simplest way to authenticate to that API.<br><br> In order to reduce attack vectors, API-Keys can be restricted only to trusted hosts, HTTP referrers and applications. |High |
|[Ensure API keys are rotated every 90 days](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/fbc1ef5d-989e-4b64-8e9d-221b422f9c43) |It is recommended to rotate API keys every 90 days. <br><br> Security risks involved in using API-Keys are listed below:<br> 1. API keys are simple encrypted strings<br> 2. API keys do not identify the user or the application making the API request<br> 3. API keys are typically accessible to clients, making it easy to discover and steal an API key <br><br>Because of these potential risks, Google recommends using the standard authentication flow instead of API Keys. However, there are limited cases where API keys are more appropriate. For example, if there is a mobile application that needs to use the Google Cloud Translation API, but doesn't otherwise need a backend server, API keys are the simplest way to authenticate to that API.<br><br> Once a key is stolen, it has no expiration, meaning it may be used indefinitely unless the project owner revokes or regenerates the key. Rotating API keys will reduce the window of opportunity for an access key that is associated with a compromised or terminated account to be used.<br><br> API keys should be rotated to ensure that data cannot be accessed with an old key that might have been lost, cracked, or stolen. |High |
|[Ensure KMS encryption keys are rotated within a period of 90 days](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/f756937d-b790-4718-8dd7-fa995930c4a1) |Google Cloud Key Management Service stores cryptographic keys in a hierarchical structure designed for useful and elegant access control management.<br/> The format for the rotation schedule depends on the client library that is used.<br/> For the gcloud command-line tool, the next rotation time must be in "ISO" or "RFC3339" format, and the rotation period must be in the form "INTEGER[UNIT]", where units can be one of seconds (s), minutes (m), hours (h) or days (d). <br/> Set a key rotation period and starting time. A key can be created with a specified "rotation period", which is the time between when new key versions are generated automatically.<br/> A key can also be created with a specified next rotation time. <br/> A key is a named object representing a "cryptographic key" used for a specific purpose.<br/> The key material, the actual bits used for "encryption", can change over time as new key versions are created.<br/> A key is used to protect some "corpus of data". A collection of files could be encrypted with the same key and people with "decrypt" permissions on that key would be able to decrypt those files.<br/> Therefore, it's necessary to make sure the "rotation period" is set to a specific time. |Medium |
|[Ensure log metric filter and alerts exist for project ownership assignments/changes](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/f42c20a6-8012-4e1e-bf4d-19b977e8c8d7) |In order to prevent unnecessary project ownership assignments to users/service-accounts and further misuses of projects and resources, all "roles/Owner" assignments should be monitored.<br> Members (users/Service-Accounts) with a role assignment to primitive role "roles/Owner" are project owners.<br> The project owner has all the privileges on the project the role belongs to. These are summarized below:<br> - All viewer permissions on all GCP Services within the project<br> - Permissions for actions that modify the state of all GCP services within the project<br> - Manage roles and permissions for a project and all resources within the project<br> - Set up billing for a project<br> Granting the owner role to a member (user/Service-Account) will allow that member to modify the Identity and Access Management (IAM) policy. Therefore, grant the owner role only if the member has a legitimate purpose to manage the IAM policy. This is because the project IAM policy contains sensitive access control data. Having a minimal set of users allowed to manage IAM policy will simplify any auditing that may be necessary. <br>Project ownership has the highest level of privileges on a project. To avoid misuse of project resources, the project ownership assignment/change actions mentioned above should be monitored and alerted to concerned recipients. <br>- Sending project ownership invites <br>- Acceptance/Rejection of project ownership invite by user <br>- Adding `role\Owner` to a user/service-account <br>- Removing a user/Service account from `role\Owner` |Low |
|[Ensure oslogin is enabled for a Project](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/49cb12f0-3dd3-4220-9cfb-5c3fd514a6d8) |Enabling OS login binds SSH certificates to IAM users and facilitates effective SSH certificate management.<br>Enabling osLogin ensures that SSH keys used to connect to instances are mapped with IAM users. Revoking access to IAM user will revoke all the SSH keys associated with that particular user.<br>It facilitates centralized and automated SSH key pair management which is useful in handling cases like response to compromised SSH key pairs and/or revocation of external/third-party/Vendor users.<br>To find out which instance causes the project to be unhealthy see recommendation "Ensure oslogin is enabled for all instances". |Medium |
|[Ensure oslogin is enabled for all instances](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/569ef64e-d7aa-4d7e-aa0b-5b3e045ca2c3) |Enabling OS login binds SSH certificates to IAM users and facilitates effective SSH certificate management.<br>Enabling osLogin ensures that SSH keys used to connect to instances are mapped with IAM users. Revoking access to IAM user will revoke all the SSH keys associated with that particular user.<br>It facilitates centralized and automated SSH key pair management which is useful in handling cases like response to compromised SSH key pairs and/or revocation of external/third-party/Vendor users. |Medium |
|[Ensure that Cloud Audit Logging is configured properly across all services and all users from a project](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/0b9173aa-68d9-4581-814f-fab4a91aa9af) |It is recommended that Cloud Audit Logging is configured to track all admin activities and read, write access to user data. <br/> Cloud Audit Logging maintains two audit logs for each project, folder, and organization: Admin Activity and Data Access. <br/> 1. Admin Activity logs contain log entries for API calls or other administrative actions that modify the configuration or metadata of resources. <br/> Admin Activity audit logs are enabled for all services and cannot be configured. 2. Data Access audit logs record API calls that create, modify, or read user-provided data. These are disabled by default and should be enabled. <br/> There are three kinds of Data Access audit log information: <br/> <ul> <li>Admin read: Records operations that read metadata or configuration information. Admin Activity audit logs record writes of metadata and configuration information that cannot be disabled. </li> <li>Data read: Records operations that read user-provided data.</li> <li>Data write: Records operations that write user-provided data.</li> </ul> It is recommended to have an effective default audit config configured in such a way that: <br/> 1. logtype is set to DATA_READ (to log user activity tracking) and DATA_WRITES (to log changes/tampering to user data). 2. audit config is enabled for all the services supported by the Data Access audit logs feature. 3. Logs should be captured for all users, i.e., there are no exempted users in any of the audit config sections. This will ensure overriding the audit config will not contradict the requirement. |Medium |
|[Ensure that Cloud KMS cryptokeys are not anonymously or publicly accessible](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/fcbcaef9-4bb0-49db-a932-afd64ed221d4) |It is recommended that the IAM policy on Cloud KMS "cryptokeys" should restrict anonymous and/or public access. <br/> Granting permissions to "allUsers" or "allAuthenticatedUsers" allows anyone to access the dataset. <br/> Such access might not be desirable if sensitive data is stored at the location. <br/> In this case, ensure that anonymous and/or public access to a Cloud KMS "cryptokey" is not allowed. |High |
|[Ensure that corporate login credentials are used](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/67ebdf6b-6197-4e42-bbbf-eaf4e6c20b4c) |Use corporate login credentials instead of personal accounts, such as Gmail accounts. <br/> It is recommended fully-managed corporate Google accounts be used for increased visibility, auditing, and controlling access to Cloud Platform resources. <br/> Gmail accounts based outside of the user's organization, such as personal accounts, should not be used for business purposes. |High |
|[Ensure that IAM users are not assigned the Service Account User or Service Account Token Creator roles at project level](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/54c381fe-a80a-4038-8a9d-c166d2922ea9) |It is recommended to assign the "Service Account User (iam.serviceAccountUser)" and "Service Account Token Creator (iam.serviceAccountTokenCreator)" roles to a user for a specific service account rather than assigning the role to a user at project level.<br> A service account is a special Google account that belongs to an application or a virtual machine (VM), instead of to an individual end-user. <br> Application/VM-Instance uses the service account to call the service's Google API so that users aren't directly involved. <br> In addition to being an identity, a service account is a resource that has IAM policies attached to it. These policies determine who can use the service account. <br> Users with IAM roles to update the App Engine and Compute Engine instances (such as App Engine Deployer or Compute Instance Admin) can effectively run code as the service accounts used to run these instances, and indirectly gain access to all the resources for which the service accounts have access. <br> Similarly, SSH access to a Compute Engine instance may also provide the ability to execute code as that instance/Service account. <br> Based on business needs, there could be multiple user-managed service accounts configured for a project. <br> Granting the "iam.serviceAccountUser" or "iam.serviceAserviceAccountTokenCreatorccountUser" roles to a user for a project gives the user access to all service accounts in the project, including service accounts that may be created in the future. <br> This can result in elevation of privileges by using service accounts and corresponding "Compute Engine instances". <br> In order to implement "least privileges" best practices, IAM users should not be assigned the "Service Account User" or "Service Account Token Creator" roles at the project level. Instead, these roles should be assigned to a user for a specific service account, giving that user access to the service account. The "Service Account User" allows a user to bind a service account to a long-running job service, whereas the "Service Account Token Creator" role allows a user to directly impersonate (or assert) the identity of a service account. |Medium |
|[Ensure that Separation of duties is enforced while assigning KMS related roles to users](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/14007242-eadd-4d15-ad54-97201351c0ec) |It is recommended that the principle of 'Separation of Duties' is enforced while assigning KMS related roles to users. <br/> The built-in/predefined IAM role "Cloud KMS Admin" allows the user/identity to create, delete, and manage service account(s).<br/> The built-in/predefined IAM role "Cloud KMS CryptoKey Encrypter/Decrypter" allows the user/identity (with adequate privileges on concerned resources) to encrypt and decrypt data at rest using an encryption key(s). <br/> The built-in/predefined IAM role Cloud KMS CryptoKey Encrypter allows the user/identity (with adequate privileges on concerned resources) to encrypt data at rest using an encryption key(s).<br/> The built-in/predefined IAM role "Cloud KMS CryptoKey Decrypter" allows the user/identity (with adequate privileges on concerned resources) to decrypt data at rest using an encryption key(s). <br/> Separation of duties is the concept of ensuring that one individual does not have all necessary permissions to be able to complete a malicious action. <br/> In Cloud KMS, this could be an action such as using a key to access and decrypt data a user should not normally have access to.<br/> Separation of duties is a business control typically used in larger organizations, meant to help avoid security or privacy incidents and errors. <br/> It is considered best practice. No user(s) should have Cloud KMS Admin and any of the "Cloud KMS CryptoKey Encrypter/Decrypter", "Cloud KMS CryptoKey Encrypter", "Cloud KMS CryptoKey Decrypter" roles assigned at the same time. |High |
|[Ensure that Separation of duties is enforced while assigning service account related roles to users](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/9e8cb9ac-87ee-424b-a9d2-0d41e411d18f) |It is recommended that the principle of 'Separation of Duties' is enforced while assigning service-account related roles to users. <br/> The built-in/predefined IAM role "Service Account admin" allows the user/identity to create, delete, and manage service account(s).<br/> The built-in/predefined IAM role "Service Account User" allows the user/identity (with adequate privileges on Compute and App Engine) to assign service account(s) to Apps/Compute Instances.<br/> Separation of duties is the concept of ensuring that one individual does not have all necessary permissions to be able to complete a malicious action. <br/> In Cloud IAM - service accounts, this could be an action such as using a service account to access resources that user should not normally have access to. <br/> Separation of duties is a business control typically used in larger organizations, meant to help avoid security or privacy incidents and errors. It is considered best practice. <br/> No user should have "Service Account Admin" and "Service Account User" roles assigned at the same time. |Medium |
|[Ensure that Service Account has no Admin privileges](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/ae77cb8b-0b43-4e86-8b5c-f5afcf95766a) |A service account is a special Google account that belongs to an application or a VM, instead of to an individual end-user.<br> The application uses the service account to call the service's Google API so that users aren't directly involved.<br> It's recommended not to use admin access for ServiceAccount.<br> Service accounts represent service-level security of the Resources (application or a VM) which can be determined by the roles assigned to it.<br> Enrolling ServiceAccount with Admin rights gives full access to an assigned application or a VM.<br> A ServiceAccount Access holder can perform critical actions like delete, update change settings, etc.<br> without user intervention.<br> For this reason, it's recommended that service accounts not have Admin rights. |Medium |
|[Ensure that sinks are configured for all log entries](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/194b473e-7c5a-4754-b1ae-76591fe11b5c) |It is recommended to create a sink that will export copies of all the log entries. This can help aggregate logs from multiple projects and export them to a Security Information and Event Management (SIEM). <br> Log entries are held in Stackdriver Logging. To aggregate logs, export them to a SIEM. To keep them longer, it is recommended to set up a log sink. Exporting involves writing a filter that selects the log entries to export, and choosing a destination in Cloud Storage, BigQuery, or Cloud Pub/Sub. <br> The filter and destination are held in an object called a sink. To ensure all log entries are exported to sinks, ensure that there is no filter configured for a sink. Sinks can be created in projects, organizations, folders, and billing accounts.  |Low |
|[Ensure that the log metric filter and alerts exist for Audit Configuration changes](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/34ed4dfb-fc6d-498f-b2b0-d1099704775d) |Google Cloud Platform (GCP) services write audit log entries to the Admin Activity and Data Access logs to help answer the questions of, "who did what, where, and when?" within GCP projects.<br>Cloud audit logging records information includes the identity of the API caller, the time of the API call, the source IP address of the API caller, the request parameters, and the response elements returned by GCP services. Cloud audit logging provides a history of GCP API calls for an account, including API calls made via the console, SDKs, command-line tools, and other GCP services.  <br>Admin activity and data access logs produced by cloud audit logging enable security analysis, resource change tracking, and compliance auditing. <br>Configuring the metric filter and alerts for audit configuration changes ensures the recommended state of audit configuration is maintained so that all activities in the project are audit-able at any point in time. |Low |
|[Ensure that the log metric filter and alerts exist for Custom Role changes](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/ba27e90d-311d-409d-8c69-7dfac0a1351c) |It is recommended that a metric filter and alarm be established for changes to Identity and Access Management (IAM) role creation, deletion and updating activities.  <br>Google Cloud IAM provides predefined roles that give granular access to specific Google Cloud Platform resources and prevent unwanted access to other resources. However, to cater to organization-specific needs, Cloud IAM also provides the ability to create custom roles. Project owners and administrators with the Organization Role Administrator role or the IAM Role Administrator role can create custom roles. Monitoring role creation, deletion and updating activities will help in identifying any over-privileged role at early stages. |Low |
|[Ensure user-managed/external keys for service accounts are rotated every 90 days or less](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/0007dd31-9e95-460d-82bd-ae3e9e623161) |Service Account keys consist of a key ID (Private_key_Id) and Private key, which are used to sign programmatic requests users make to Google cloud services accessible to that particular service account. <br> It is recommended that all Service Account keys are regularly rotated. <br> Rotating Service Account keys will reduce the window of opportunity for an access key that is associated with a compromised or terminated account to be used. Service Account keys should be rotated to ensure that data cannot be accessed with an old key that might have been lost, cracked, or stolen.<br> Each service account is associated with a key pair managed by Google Cloud Platform (GCP). It is used for service-to-service authentication within GCP. Google rotates the keys daily. <br> GCP provides the option to create one or more user-managed (also called external key pairs) key pairs for use from outside GCP (for example, for use with Application Default Credentials). When a new key pair is created, the user is required to download the private key (which is not retained by Google). </br> With external keys, users are responsible for keeping the private key secure and other management operations such as key rotation. External keys can be managed by the IAM API, gcloud command-line tool, or the Service Accounts page in the Google Cloud Platform Console.</br> GCP facilitates up to 10 external service account keys per service account to facilitate key rotation. |Medium |
|[GKE web dashboard should be disabled](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/d8fa5c03-a8e8-467b-992c-ad8b2db0f55e) |This recommendation evaluates the kubernetesDashboard field of the addonsConfig property for the key-value pair, 'disabled': false. |High |
|[Legacy Authorization should be disabled on GKE clusters](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/bd1096e1-73cf-41ab-8f2a-257b78aed9dc) |This recommendation evaluates the legacyAbac property of a cluster for the key-value pair, 'enabled': true. |High |
|[Redis IAM role should not be assigned at the organization or folder level](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/7c20b7aa-be3d-4a4b-af45-1b432c02f86b) |This recommendation evaluates the IAM allow policy in resource metadata for principals assigned roles/redis.admin, roles/redis.editor, roles/redis.viewer at the organization or folder level. |High |
|[Service accounts should have restricted project access in a cluster](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/b73bad4f-4ea7-4d04-bab0-d400cb3ad639) |This recommendation evaluates the config property of a node pool to check if no service account is specified or if the default service account is used. |High |
|[Users should have least privilege access with granular IAM roles](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/4a7771a9-a2dd-40e8-87a2-921259d68667) |This recommendation evaluates the IAM policy in resource metadata for any principals assigned roles/Owner, roles/Writer, or roles/Reader. |High |
|||
